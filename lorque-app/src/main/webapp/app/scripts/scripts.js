angular.module("lorque.config",[]).constant("config",{api:"/lorque",title:"Lorque"}),angular.module("lorque",["ngResource","ngRoute","lorque.query","lorque.settings","lorque.config","lorque.layout"]).config(["$routeProvider",function(a){a.otherwise({redirectTo:"/queries"})}]),angular.module("templates-main",[]),angular.module("templates-main",["modules/core/main.html","modules/layout/footer.html","modules/layout/header.html","modules/query/query-list.html","modules/query/query.html","modules/settings/settings.html"]),angular.module("modules/core/main.html",[]).run(["$templateCache",function(a){a.put("modules/core/main.html",'<div><table class="table table-hover"><thead><tr><th>ID<th>SQL<th>Parameters<th>Submitted<th>Started<th>Finished<th>Status<tbody><tr ng-repeat="query in queries"><th scope="row">{{query.id}}<td>{{query.sql}}<td>{{query.parameters}}<td>{{formatDate(query.submitTime)}}<td>{{formatDate(query.startTime)}}<td>{{formatDate(query.endTime)}}<td><button type="button" ng-class="\'btn-block btn btn-\' + getStatusButtonClass(query)">{{query.status}}</button></table></div>')}]),angular.module("modules/layout/footer.html",[]).run(["$templateCache",function(a){a.put("modules/layout/footer.html",'<div id="footer"><div class="container"><p class="text-muted">&copy; 2015 Nortal DelEx Team. delex@nortal.com</p></div></div>')}]),angular.module("modules/layout/header.html",[]).run(["$templateCache",function(a){a.put("modules/layout/header.html",'<nav class="navbar navbar-default" role="navigation" ng-controller="HeaderCtrl"><div class="container-fluid"><!-- Brand and toggle get grouped for better mobile display --><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="#">{{title}}</a></div><script>function closeMenu() {\n        var toggleButton = $(\'.navbar-toggle\');\n        if (toggleButton.css(\'display\') !== \'none\') {\n          console.log(\'will close\');\n          toggleButton.click();\n        }\n      }</script><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"><ul class="nav navbar-nav"><li><a href="#queries" onclick="closeMenu()" anga-active-link>Queries</a></li><li><a href="#queries/new" onclick="closeMenu()" anga-active-link>New query</a></li><li><a href="#settings" onclick="closeMenu()" anga-active-link>Settings</a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-if="!session.anonymous"><a>Anonymous</a></li><!--<li ng-if="!session.anonymous" class="logout"><a href="{{api}}/api/v1/security/logout?url={{url}}">Logout</a>--><!--</li>--><!--<li ng-if="session.anonymous" class="logout"><a href="" ng-click="auth()">Login</a></li>--></ul></div><!-- /.navbar-collapse --></div><!-- /.container-fluid --></nav>')}]),angular.module("modules/query/query-list.html",[]).run(["$templateCache",function(a){a.put("modules/query/query-list.html",'<div><table class="table table-hover"><thead><tr><th>ID<th>SQL<th>Parameters<th>Submitted<th>Started<th>Finished<th>Status<tbody><tr ng-repeat="query in queries" ng-click="navigateToQueryDetails(query.id)"><th scope="row">{{query.id}}<td>{{query.sql}}<td>{{query.parameters}}<td>{{formatDate(query.submitTime)}}<td>{{formatDate(query.startTime)}}<td>{{formatDate(query.endTime)}}<td><button type="button" ng-class="\'btn-block btn btn-\' + getStatusButtonClass(query)">{{query.status}}</button></table></div>')}]),angular.module("modules/query/query.html",[]).run(["$templateCache",function(a){a.put("modules/query/query.html",'<form ng-submit="submitQuery()"><div class="form-group"><label for="querySql">Query SQL</label><textarea id="querySql" class="form-control" rows="7" ng-model="query.sql" ng-disabled="query.id != undefined"></textarea></div><div class="form-group" ng-repeat="parameter in query.parameters track by $index"><label>Parameter #{{$index+1}}</label><div class="input-group"><span class="input-group-addon"><select ng-model="parameter.type" ng-disabled="query.id != undefined" ng-options="type.name as type.name for type in sqlTypes"></select></span> <input type="text" class="form-control" ng-model="parameter.value" ng-disabled="query.id != undefined"></div></div><div class="form-group"><label>Callback</label><div class="input-group"><span class="input-group-addon"><select ng-model="query.callback.method" ng-disabled="query.id != undefined"><option value="GET">GET<option value="POST">POST</select></span> <input type="text" class="form-control" placeholder="http://" ng-model="query.callback.url" ng-disabled="query.id != undefined"></div></div><pre>{{query | json}}</pre><button type="submit" class="btn btn-primary" ng-if="query.id == undefined">Submit</button><div class="form-group" ng-if="query.result"><label>Result</label><pre>{{query.result | json}}</pre></div><div class="form-group" ng-if="query.error"><label>Error</label><pre>{{query.error | json}}</pre></div></form>')}]),angular.module("modules/settings/settings.html",[]).run(["$templateCache",function(a){a.put("modules/settings/settings.html",'<div><table class="table table-hover"><thead><tr><th>Key<th>Value<tbody><tr ng-repeat="s in settings"><th scope="row">{{s.left}}<td>{{s.right}}</table></div>')}]),angular.module("lorque.layout",["templates-main"]).controller("HeaderCtrl",["$scope","$rootScope","$location","$window","config",function(a,b,c,d,e){a.url=d.location.href,a.title=e.title,a.api=e.api}]).directive("angaActiveLink",["$location",function(a){return{restrict:"A",link:function(b,c,d){var e=d.href;b.$on("$routeChangeSuccess",function(){a.path().substring(1)===e.substring(1)?c.parent().addClass("active"):c.parent().removeClass("active")})}}}]),angular.module("lorque.query",[]).config(["$routeProvider",function(a){a.when("/queries",{templateUrl:"modules/query/query-list.html",controller:"QueryListCtrl"}).when("/queries/:queryId",{templateUrl:"modules/query/query.html",controller:"QueryCtrl"})}]).controller("QueryListCtrl",["$scope","$resource","$location","config",function(a,b,c,d){a.queries=b(d.api+"/api/v1/queries").query();var e=new WebSocket("ws://localhost:8080/lorque/ws/queries");e.onopen=function(){console.log("Socket has been opened!")},e.onmessage=function(b){var c=JSON.parse(b.data),d=f(c.id);0>d?a.queries.push(c):a.queries[d]=c,a.$apply()};var f=function(b){var c=_.findWhere(a.queries,{id:b});return _.indexOf(a.queries,c)};a.formatDate=function(a){return _.isUndefined(a)?"":moment(a,"YYYY-MM-DDTHH:mm:ssZ").format("DD.MM.YYYY HH:mm:ss")},a.getStatusButtonClass=function(a){return"SUBMITTED"===a.status?"default":"RUNNING"===a.status?"info":"COMPLETED"===a.status?"success":"FAILED"===a.status?"danger":void 0},a.navigateToQueryDetails=function(a){c.path("/queries/"+a)}}]).controller("QueryCtrl",["$scope","$resource","$routeParams","$location","config",function(a,b,c,d,e){a.query="new"===c.queryId?{}:b(e.api+"/api/v1/queries/"+c.queryId).get(),a.query.parameters=a.query.parameters||[],a.$watch("query.sql",function(){a.query.parameters=f()});var f=function(){for(var b=_.isUndefined(a.query.sql)?0:(a.query.sql.match(/\?/g)||[]).length,c=a.query.parameters||[];c.length!==b;)c.length<b?c.push({}):c.pop();return c};a.range=function(a){return new Array(a)},a.sqlTypes=[{code:-7,name:"BIT"},{code:-6,name:"TINYINT"},{code:5,name:"SMALLINT"},{code:4,name:"INTEGER"},{code:-5,name:"BIGINT"},{code:6,name:"FLOAT"},{code:7,name:"REAL"},{code:8,name:"DOUBLE"},{code:2,name:"NUMERIC"},{code:3,name:"DECIMAL"},{code:1,name:"CHAR"},{code:12,name:"VARCHAR"},{code:-1,name:"LONGVARCHAR"},{code:91,name:"DATE"},{code:92,name:"TIME"},{code:93,name:"TIMESTAMP"},{code:-2,name:"BINARY"},{code:-3,name:"VARBINARY"},{code:-4,name:"LONGVARBINARY"},{code:0,name:"NULL"},{code:1111,name:"OTHER"},{code:2e3,name:"JAVA_OBJECT"},{code:2001,name:"DISTINCT"},{code:2002,name:"STRUCT"},{code:2003,name:"ARRAY"},{code:2004,name:"BLOB"},{code:2005,name:"CLOB"},{code:2006,name:"REF"},{code:70,name:"DATALINK"},{code:16,name:"BOOLEAN"},{code:-8,name:"ROWID"},{code:-15,name:"NCHAR"},{code:-9,name:"NVARCHAR"},{code:-16,name:"LONGNVARCHAR"},{code:2011,name:"NCLOB"},{code:2009,name:"SQLXML"},{code:2012,name:"REF_CURSOR"},{code:2013,name:"TIME_WITH_TIMEZONE"},{code:2014,name:"TIMESTAMP_WITH_TIMEZONE"}],a.submitQuery=function(){b(e.api+"/api/v1/queries").save(a.query,function(){d.path("/queries")})}}]),angular.module("lorque.settings",[]).config(["$routeProvider",function(a){a.when("/settings",{templateUrl:"modules/settings/settings.html",controller:"SettingsCtrl"})}]).controller("SettingsCtrl",["$scope","$resource","config",function(a,b,c){a.settings=b(c.api+"/api/v1/settings").query()}]);